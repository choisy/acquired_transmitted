---
title: "Acquired and transmitted resistance"
number-sections: true
format:
  html:
    toc: true
    toc-depth: 4
editor: source
editor_options: 
  chunk_output_type: console
#bibliography: references.bib
#csl: the-american-naturalist.csl
---

```{r include = FALSE, eval = FALSE}
# The code that adds the .nojekyll file to the GitHub repository:
file <- ".nojekyll"
file.create(file)
gert::git_add(file)
gert::git_commit("Adding the .nojekyll file")
gert::git_push()
rm(file)
```

```{r include = FALSE, eval = FALSE}
run_all <- function() {
  knitr::purl("index.qmd", "tmp.R", documentation = FALSE)
  source("tmp.R")
  file.remove("tmp.R")  
}

rerun_all <- function() {
  rm(list  = grep("run_all", ls(envir = .GlobalEnv), value = TRUE, invert = TRUE),
     envir = .GlobalEnv)
  run_all()
}
```

```{r include = FALSE}
setHook("plot.new", NULL, action = "replace")

par2 <- function(...) par(..., mgp = c(1.5, .5, 0), bty = "n")

knitr::knit_hooks$set(
  margin = function(before, options, envir) {
    if (before) par2(plt = c(.105, .97, .15, .95)) else NULL
  })

figw <- 7  # default is 7
figh <- 5  # default is 5
eps <- .7

knitr::opts_chunk$set(margin     = TRUE,
                      fig.retina = 2,
                      fig.align  = "center",
                      fig.width  = eps * figw,
                      fig.height = eps * figh) 
```

```{r}
library(deSolve)
```

$$
\frac{dS}{dt} = (I_t + I_a + I_s)\gamma + (1 - p)\alpha I_s -
                [(I_t + I_a)c + I_s]\beta S
$$

$$
\frac{dI_s}{dt} = \beta I_s S - (\gamma + \alpha)I_s
$$

$$
\frac{dI_a}{dt} = p\alpha I_s - \gamma I_a
$$

$$
\frac{I_t}{dt} = (I_t + I_a)Sc\beta - \gamma I_t
$$

```{r}
model <- function(time, state, pars) {
  with(as.list(c(state, pars)), {
    G <- c * beta * (Ia + It) * S
    A <- beta * Is * S
    B <- gamma * Is
    C <- gamma * Ia
    D <- gamma * It
    E <- alpha * Is
    
    dS  <- B + C + D + (1 - p) * E - G - A
    dIs <- A - B - E
    dIa <- p * E - C
    dIt <- G - D
    
    list(c(dS, dIs, dIa, dIt))
  })
}
```

```{r eval = FALSE}
f <- function(beta, c, gamma, alpha, p, times = seq(0, 10, le = 512)) {
  S0 <- gamma / beta
  ode(c(S = S0, Is = 1 - S0, Ia = 0, It = 0), times, model)  
}

f()
```

